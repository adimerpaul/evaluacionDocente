import{b as y,a as v,Q as S}from"./QTable.12256c00.js";import{_ as V,n as u,p as g,q as o,t as n,s as t,v as r,W as C,u as _,a$ as w,af as q,S as h,P as E,O as x,a_ as D,$ as A}from"./index.3c804d13.js";import{Q as c,a as m}from"./format.92df8c4d.js";import{Q as O}from"./QList.12a4f095.js";import{Q as F}from"./QBtnDropdown.0dfd416c.js";import{Q as G}from"./QBadge.79b22c87.js";import{Q as I}from"./QSpace.93a8d210.js";import{a as k,C as f}from"./ClosePopup.d799f106.js";import{Q as B}from"./QForm.a15b2ef0.js";import{Q as M}from"./QPage.b0c4ab05.js";import{g as N}from"./globalStore.cc54f428.js";import{h as Q}from"./moment.9709ab41.js";const L={name:"asignarPage",data(){return{store:N(),asignaStatus:"create",paralelos:["A","B","C","D","E","F","G","H","I","J","K","L","M","N"],gestion:Q().format("YYYY"),loading:!1,asignaShow:!1,asignas:[],asigna:{},materias:[],materia:{label:""},docente:{label:""},filterMateria:[],docentes:[],filterDocente:[],asignaFiltar:"",docentematerias:[],asignaColumns:[{name:"opcion",label:"Opcion",field:"opcion",align:"left",sortable:!1},{name:"codigo",label:"Codigo",field:"codigo",align:"left",sortable:!0},{name:"paralelo",label:"Par",field:"paralelo",align:"left",sortable:!0},{name:"gestion",label:"Gestion",field:"gestion",align:"left",sortable:!0},{name:"estado",label:"Estado",field:"activo",align:"left",sortable:!0},{name:"docente",label:"DOCENTE",field:a=>a.docente.name,align:"left",sortable:!0},{name:"materia",label:"MATERIA",field:a=>a.materia.name,align:"left",sortable:!0}]}},mounted(){this.materiasGet(),this.docenteGet(),this.asignaciones()},methods:{cambio(a){this.$api.post("cambioEstado",a).then(()=>{this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",position:"top",message:"Cambio Estado"}),this.asignaciones()})},codigo(a){const e=a;this.$q.dialog({title:"CODIGO EVALUACION",message:"Se generara un nuevo codigo para la evaluacion",cancel:!0,persistent:!1}).onOk(d=>{e.codigo=d,this.$api.post("cambioCodigo",e).then(()=>{this.asignaciones(),this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",position:"top",message:"Cambio Codigo"})})}).onCancel(()=>{}).onDismiss(()=>{})},baja(a){this.$q.dialog({title:"Dar de Baja",message:"\xBFEstas seguro de dar de baja esta evaluacion?",cancel:!0,persistent:!0}).onOk(()=>{this.loading=!0,this.$api.post("bajaEvaluacion",{id:a.id}).then(()=>{this.asignaciones(),this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",position:"top",message:"Evaluacion dada de baja correctamente"})}).catch(e=>{this.loading=!1,this.$q.notify({color:"red-4",textColor:"white",icon:"cloud_done",position:"top",message:e.response.data.message})})})},asignaEdit(a){this.asignaStatus="edit",this.asignaShow=!0,this.asigna=a,this.docente=a.docente,this.docente.label=this.docente.name,this.materia=a.materia,this.materia.label=this.materia.name},materiaDelete(a){this.$q.dialog({title:"Eliminar Asignacion",message:"\xBFEstas seguro de eliminar esta Asignacion?",cancel:!0,persistent:!0}).onOk(()=>{this.loading=!0,this.$api.delete(`docentemateria/${a.id}`).then(()=>{this.asignaGet(),this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",position:"top",message:"Asignacion eliminada correctamente"})}).catch(e=>{this.loading=!1,this.$q.notify({color:"red-4",textColor:"white",icon:"cloud_done",position:"top",message:e.response.data.message})})})},asignaCreate(){this.asignaStatus="create",this.asigna={gestion:Q().format("YYYY"),paralelo:"A",materia_id:null,docente_id:null},this.asignaShow=!0},asignaSubmit(){if(this.docente.id===void 0||this.materia.id===void 0)return!1;this.$q.loading.show(),this.asigna.docente_id=this.docente.id,this.asigna.materia_id=this.materia.id,this.asignaStatus==="create"?this.$api.post("docentemateria",this.asigna).then(()=>{this.asignaciones(),this.asignaShow=!1}).finally(()=>{this.$q.loading.hide()}):this.$api.put("docentemateria/"+this.asigna.id,this.asigna).then(a=>{console.log(a.data),this.asignaciones(),this.asignaShow=!1}).finally(()=>{this.$q.loading.hide()})},filterMat(a,e){if(a===""){e(()=>{this.materias=this.filterMateria});return}e(()=>{const d=a.toLowerCase();this.materias=this.filterMateria.filter(p=>p.label.toLowerCase().indexOf(d)>-1)})},filterDoc(a,e){if(a===""){e(()=>{this.docentes=this.filterDocente});return}e(()=>{const d=a.toLowerCase();this.docentes=this.filterDocente.filter(p=>p.label.toLowerCase().indexOf(d)>-1)})},materiasGet(){this.materias=[],this.loading=!0,this.$api.get("materia").then(a=>{a.data.forEach(e=>{e.label=e.name+" : "+e.sigla,this.materias.push(e)}),this.filterMateria=this.materias}).finally(()=>{this.loading=!1})},docenteGet(){this.docentes=[],this.loading=!0,this.$api.get("docente").then(a=>{a.data.forEach(e=>{e.label=e.name,this.docentes.push(e)}),this.filterDocente=this.docentes}).finally(()=>{this.loading=!1})},asignaciones(){this.loading=!0,this.$api.get("docentemateria").then(a=>{this.docentematerias=a.data}).finally(()=>{this.loading=!1})}}},T={class:"row"},Y={class:"col-12"},j={class:"text-h6"},U={class:"row"},P={class:"col-md-6 col-xs-12 q-pa-xs"},$={class:"col-md-6 col-xs-12 q-pa-xs"},R={class:"col-md-6 col-xs-12 q-pa-xs"},H={class:"col-md-6 col-xs-12 q-pa-xs"},J={class:"col-12 col-md-12 text-center q-pt-xs"};function K(a,e,d,p,s,l){return u(),g(M,{class:"q-pa-xs"},{default:o(()=>[n("div",T,[n("div",Y,[t(S,{title:"Lista Asignacion",loading:s.loading,"rows-per-page-options":[0],columns:s.asignaColumns,rows:s.docentematerias,flat:"",bordered:"",dense:"",filter:s.asignaFiltar},{"header-cell":o(i=>[t(y,{props:i,class:"bg-primary text-white text-center"},{default:o(()=>[r(C(i.col.label),1)]),_:2},1032,["props"])]),"top-right":o(()=>[t(_,{label:"Asignar",color:"primary","no-caps":"",icon:"add_circle_outline",onClick:l.asignaCreate,dense:""},null,8,["onClick"]),t(_,{round:"",icon:"refresh",onClick:l.asignaciones,dense:"",loading:a.refresh},null,8,["onClick","loading"]),t(w,{outlined:"",dense:"",modelValue:s.asignaFiltar,"onUpdate:modelValue":e[0]||(e[0]=i=>s.asignaFiltar=i),label:"Buscar",class:"q-ml-md",clearable:""},{append:o(()=>[t(q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-opcion":o(i=>[t(v,{props:i,"auto-width":""},{default:o(()=>[r(" ("+C(i.row.cantidad)+") ",1),t(F,{round:"",dense:"",color:"primary","dropdown-icon":"more_vert",label:"Acciones","no-caps":""},{default:o(()=>[t(O,null,{default:o(()=>[i.row.activo=="INACTIVO"?h((u(),g(c,{key:0,clickable:""},{default:o(()=>[t(m,{onClick:b=>l.codigo(i.row)},{default:o(()=>[r("Generar Codigo")]),_:2},1032,["onClick"])]),_:2},1024)),[[f]]):h((u(),g(c,{key:1,clickable:""},{default:o(()=>[t(m,{onClick:b=>l.baja(i.row)},{default:o(()=>[r("Dar de Baja")]),_:2},1032,["onClick"])]),_:2},1024)),[[f]]),h((u(),g(c,{clickable:""},{default:o(()=>[t(m,{onClick:b=>l.asignaEdit(i.row)},{default:o(()=>[r("Editar")]),_:2},1032,["onClick"])]),_:2},1024)),[[f]]),h((u(),g(c,{clickable:""},{default:o(()=>[t(m,{onClick:b=>a.asignaDelete(i.row)},{default:o(()=>[r("Eliminar")]),_:2},1032,["onClick"])]),_:2},1024)),[[f]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-estado":o(i=>[t(v,{props:i,"auto-width":""},{default:o(()=>[t(G,{color:i.row.activo=="ACTIVO"?"green":"red",label:i.row.activo,onClick:b=>l.cambio(i.row)},null,8,["color","label","onClick"])]),_:2},1032,["props"])]),_:1},8,["loading","columns","rows","filter"])])]),t(A,{modelValue:s.asignaShow,"onUpdate:modelValue":e[5]||(e[5]=i=>s.asignaShow=i)},{default:o(()=>[t(E,null,{default:o(()=>[t(x,{class:"row items-center q-pb-none"},{default:o(()=>[n("div",j,C(s.asignaStatus=="create"?"Registrar ":"Editar "),1),t(I),h(t(_,{flat:"",icon:"close"},null,512),[[f]])]),_:1}),t(x,null,{default:o(()=>[t(B,{onSubmit:D(l.asignaSubmit,["prevent"]),ref:"myForm"},{default:o(()=>[n("div",U,[n("div",P,[t(k,{outlined:"",dense:"",modelValue:s.materia,"onUpdate:modelValue":e[1]||(e[1]=i=>s.materia=i),label:"Materias",options:s.materias,"use-input":"","input-debounce":"0",onFilter:l.filterMat},{"no-option":o(()=>[t(c,null,{default:o(()=>[t(m,{class:"text-grey"},{default:o(()=>[r(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),n("div",$,[t(k,{outlined:"",dense:"",modelValue:s.docente,"onUpdate:modelValue":e[2]||(e[2]=i=>s.docente=i),label:"Docentes",options:s.docentes,"use-input":"","input-debounce":"0",onFilter:l.filterDoc},{"no-option":o(()=>[t(c,null,{default:o(()=>[t(m,{class:"text-grey"},{default:o(()=>[r(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter"])]),n("div",R,[t(w,{dense:"",outlined:"",modelValue:s.asigna.paralelo,"onUpdate:modelValue":e[3]||(e[3]=i=>s.asigna.paralelo=i),label:"Paralelo",required:""},null,8,["modelValue"])]),n("div",H,[t(w,{dense:"",outlined:"",modelValue:s.asigna.gestion,"onUpdate:modelValue":e[4]||(e[4]=i=>s.asigna.gestion=i),label:"Gestion",required:"",rules:[i=>i>1900&&i<9999||"ingrese gestion valida"]},null,8,["modelValue","rules"])]),n("div",J,[t(_,{loading:s.loading,color:"primary",label:"Guardar",type:"submit","no-caps":"",icon:"save",class:"full-width"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var re=V(L,[["render",K]]);export{re as default};
